-- 冥想问题库表
CREATE TABLE meditation_ask (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    meditation_id VARCHAR(255) NOT NULL COMMENT '冥想ID/关联ID(使用ChromaDB原始ID)',
    question TEXT NOT NULL COMMENT '问题内容',
    create_by BIGINT NOT NULL COMMENT '创建人ID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    INDEX idx_meditation_id (meditation_id),
    INDEX idx_create_time (create_time),
    INDEX idx_create_by (create_by)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='冥想问题库';

-- 冥想音乐曲目库表
CREATE TABLE meditation_plays (
    id VARCHAR(255) PRIMARY KEY COMMENT '主键ID(使用ChromaDB原始ID)',
    description TEXT COMMENT '曲目描述',
    attached VARCHAR(500) COMMENT '附件路径/URL',
    create_by BIGINT NOT NULL COMMENT '创建人ID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    completion_rate DECIMAL(5,2) DEFAULT 0.00 COMMENT '播放完整度(100分满分)',
    INDEX idx_create_by (create_by),
    INDEX idx_create_time (create_time),
    INDEX idx_completion_rate (completion_rate)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='冥想音乐曲目库';

-- 冥想播放日志表
CREATE TABLE meditation_play_logs (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    user_id BIGINT NOT NULL COMMENT '用户ID',
    content TEXT COMMENT '沟通内容',
    play_id VARCHAR(255) NOT NULL COMMENT '播放的曲目ID(使用ChromaDB原始ID)',
    play_time INT DEFAULT 0 COMMENT '播放时长(秒)',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    create_by BIGINT COMMENT '创建人ID',
    INDEX idx_user_id (user_id),
    INDEX idx_play_id (play_id),
    INDEX idx_create_time (create_time),
    INDEX idx_user_play (user_id, play_id),
    FOREIGN KEY (play_id) REFERENCES meditation_plays(id) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='冥想播放日志';

-- 冥想纯音乐素材表
CREATE TABLE meditation_backgrounds (
    id BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '主键ID',
    title VARCHAR(200) NOT NULL COMMENT '素材标题',
    tags VARCHAR(300) COMMENT '标签(多个用逗号分隔)',
    attached VARCHAR(500) COMMENT '附件路径/URL',
    create_by BIGINT NOT NULL COMMENT '创建人ID',
    create_time DATETIME DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间', 
    INDEX idx_title (title),
    INDEX idx_create_by (create_by),
    INDEX idx_create_time (create_time),
    FULLTEXT INDEX idx_tags (tags) COMMENT '全文索引用于标签搜索'
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci COMMENT='冥想纯音乐素材库';
